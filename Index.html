<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>CC3 HAIR ORDER APP</title>
  
  <!-- ZXing ë°”ì½”ë“œ ìŠ¤ìº” ë¼ì´ë¸ŒëŸ¬ë¦¬ (ë” ê°•ë ¥í•˜ê³  ëª¨ë°”ì¼ ìµœì í™”) -->
  <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, #FFE4B5 0%, #FFB6C1 100%);
      min-height: 100vh;
      padding: 10px;
      transition: background 0.3s ease;
    }
    
    /* íšŒì‚¬ë³„ ë°°ê²½ í…Œë§ˆ */
    body.theme-outre {
      background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
    }
    
    body.theme-sng {
      background: linear-gradient(135deg, #4169E1 0%, #9370DB 100%);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    
    /* ===== í—¤ë” ===== */
    .header {
      background: linear-gradient(135deg, #FFE4B5 0%, #FFB6C1 100%);
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: relative;
      transition: background 0.3s ease;
    }
    
    .header.theme-outre {
      background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
    }
    
    .header.theme-sng {
      background: linear-gradient(135deg, #4169E1 0%, #9370DB 100%);
    }
    
    .header h1 {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
    }
    
    .order-complete-header-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      padding: 8px 16px;
      background: rgba(255,255,255,0.3);
      color: white;
      border: 2px solid white;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .order-complete-header-btn:active {
      background: rgba(255,255,255,0.5);
    }
    
    .content {
      padding: 20px;
    }
    
    /* ===== ë°”ì½”ë“œ ì…ë ¥ ì„¹ì…˜ ===== */
    #inputSection {
      display: block;
    }
    
    .input-label {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
    }
    
    .barcode-container {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    #barcodeDisplay {
      flex: 1;
      height: 60px;
      font-size: 32px;
      font-weight: 700;
      text-align: center;
      border: 3px solid #FFB6C1;
      border-radius: 12px;
      padding: 10px;
      letter-spacing: 3px;
      background: #FFF8F0;
      color: #333;
      outline: none;
      transition: border-color 0.3s;
    }
    
    #barcodeDisplay.theme-outre {
      border-color: #FF8C00;
    }
    
    #barcodeDisplay.theme-sng {
      border-color: #4169E1;
    }
    
    .camera-btn {
      height: 60px;
      padding: 0 20px;
      background: linear-gradient(135deg, #FFB6C1 0%, #FF69B4 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      white-space: nowrap;
      transition: background 0.3s;
    }
    
    .camera-btn.theme-outre {
      background: linear-gradient(135deg, #32CD32 0%, #228B22 100%);
    }
    
    .camera-btn.theme-sng {
      background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%);
    }
    
    .camera-btn:active {
      transform: scale(0.98);
    }
    
    /* ===== ìˆ«ì í‚¤íŒ¨ë“œ ===== */
    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .key-btn {
      height: 60px;
      font-size: 24px;
      font-weight: 700;
      background: white;
      border: 2px solid #FFB6C1;
      border-radius: 12px;
      color: #FFB6C1;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      user-select: none;
      transition: border-color 0.3s, color 0.3s, background 0.3s;
    }
    
    .key-btn.theme-outre {
      border-color: #FF8C00;
      color: #FF8C00;
    }
    
    .key-btn.theme-sng {
      border-color: #4169E1;
      color: #4169E1;
    }
    
    .key-btn:active {
      transform: scale(0.95);
      background: #FFF8F0;
    }
    
    .key-btn.delete {
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      color: white;
      border: none;
    }
    
    /* ===== ì¹´ë©”ë¼ ëª¨ë‹¬ ===== */
    #cameraModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      z-index: 9999;
    }
    
    #cameraModal.active {
      display: flex;
      flex-direction: column;
    }
    
    .camera-header {
      background: rgba(255, 182, 193, 0.95);
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      transition: background 0.3s;
    }
    
    .camera-header.theme-outre {
      background: rgba(255, 140, 0, 0.95);
    }
    
    .camera-header.theme-sng {
      background: rgba(65, 105, 225, 0.95);
    }
    
    .camera-viewport {
      flex: 1;
      position: relative;
      background: black;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    #canvas {
      display: none;
    }
    
    .camera-footer {
      padding: 20px;
      background: rgba(0,0,0,0.9);
    }
    
    .close-camera-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
    }
    
    .close-camera-btn:active {
      transform: scale(0.98);
    }
    
    /* ===== ë¡œë”© ===== */
    #loading {
      display: none;
      text-align: center;
      padding: 40px;
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #FFB6C1;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      transition: border-top-color 0.3s;
    }
    
    .spinner.theme-outre {
      border-top-color: #FF8C00;
    }
    
    .spinner.theme-sng {
      border-top-color: #4169E1;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 18px;
      color: #FFB6C1;
      font-weight: 600;
      transition: color 0.3s;
    }
    
    .loading-text.theme-outre {
      color: #FF8C00;
    }
    
    .loading-text.theme-sng {
      color: #4169E1;
    }
    
    /* ===== ê²°ê³¼ ì„¹ì…˜ ===== */
    #resultsSection {
      display: none;
    }
    
    /* ìƒë‹¨ ì•¡ì…˜ ë²„íŠ¼ (4ê°œ ë‚˜ë€íˆ) */
    .action-buttons-top {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .action-btn-top {
      height: 55px;
      font-size: 18px;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      user-select: none;
      transition: background 0.3s, transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }
    
    .action-btn-top.add {
      background: linear-gradient(135deg, #FFB6C1 0%, #FF69B4 100%);
    }
    
    .action-btn-top.add.theme-outre {
      background: linear-gradient(135deg, #32CD32 0%, #228B22 100%);
    }
    
    .action-btn-top.add.theme-sng {
      background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%);
    }
    
    .action-btn-top.save-camera {
      background: linear-gradient(135deg, #4169E1 0%, #6495ED 100%);
    }
    
    .action-btn-top.save-back {
      background: linear-gradient(135deg, #808080 0%, #696969 100%);
    }
    
    .action-btn-top.cart {
      background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
    }
    
    .action-btn-top:active {
      transform: scale(0.98);
    }
    
    .results-header {
      display: none;
    }
    
    .order-complete-btn {
      display: none;
    }
    
    /* ===== ìˆ˜ëŸ‰ ì¡°ì ˆ ë²„íŠ¼ ===== */
    .quantity-controls {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .qty-btn {
      height: 50px;
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(135deg, #FFB6C1 0%, #FF69B4 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      user-select: none;
      transition: background 0.3s;
    }
    
    .qty-btn.theme-outre {
      background: linear-gradient(135deg, #32CD32 0%, #228B22 100%);
    }
    
    .qty-btn.theme-sng {
      background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%);
    }
    
    .qty-btn:active {
      transform: scale(0.95);
    }
    
    .qty-btn.clear {
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
    }
    
    /* ===== ì œí’ˆ í…Œì´ë¸” ===== */
    .table-container {
      overflow-x: auto;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-height: 500px;
      overflow-y: auto;
    }
    
    .products-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    
    .products-table thead {
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .products-table th {
      background: linear-gradient(135deg, #FFB6C1 0%, #FF69B4 100%);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      font-size: 16px;
      transition: background 0.3s;
    }
    
    .products-table.theme-outre th {
      background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
    }
    
    .products-table.theme-sng th {
      background: linear-gradient(135deg, #4169E1 0%, #9370DB 100%);
    }
    
    .products-table td {
      padding: 15px;
      border-bottom: 1px solid #e0e0e0;
      font-size: 16px;
    }
    
    .products-table tbody tr {
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .products-table tbody tr:hover {
      background-color: #FFF8F0;
    }
    
    .products-table tbody tr.selected {
      background-color: #FFE4B5 !important;
      border-left: 4px solid #FFB6C1;
      transition: border-left-color 0.3s;
    }
    
    .products-table.theme-outre tbody tr.selected {
      border-left-color: #FF8C00;
    }
    
    .products-table.theme-sng tbody tr.selected {
      border-left-color: #4169E1;
    }
    
    .quantity-input {
      width: 80px;
      height: 45px;
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      border: 2px solid #FFB6C1;
      border-radius: 8px;
      background: white;
      color: #FFB6C1;
      cursor: pointer;
      outline: none !important;
      transition: border-color 0.3s, color 0.3s;
    }
    
    .quantity-input.theme-outre {
      border-color: #FF8C00;
      color: #FF8C00;
    }
    
    .quantity-input.theme-sng {
      border-color: #4169E1;
      color: #4169E1;
    }
    
    .quantity-input::-webkit-outer-spin-button,
    .quantity-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    /* íšŒì‚¬ ë±ƒì§€ */
    .company-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 700;
      color: white;
    }
    
    .company-badge.outre {
      background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
    }
    
    .company-badge.sng {
      background: linear-gradient(135deg, #4169E1 0%, #9370DB 100%);
    }
    
    /* ì£¼ë¬¸ í˜ì´ì§€ ì´ë™ ë²„íŠ¼ */
    .goto-order-btn {
      padding: 8px 16px;
      background: linear-gradient(135deg, #4169E1 0%, #6495ED 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    
    .goto-order-btn:active {
      transform: scale(0.95);
    }
    
    /* ===== ì•¡ì…˜ ë²„íŠ¼ ===== */
    .action-buttons {
      display: flex;
      gap: 10px;
    }
    
    .action-btn {
      flex: 1;
      padding: 18px;
      font-size: 18px;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      user-select: none;
      transition: background 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .action-btn.add {
      background: linear-gradient(135deg, #FFB6C1 0%, #FF69B4 100%);
      color: white;
    }
    
    .action-btn.add.theme-outre {
      background: linear-gradient(135deg, #32CD32 0%, #228B22 100%);
    }
    
    .action-btn.add.theme-sng {
      background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%);
    }
    
    .action-btn.save-camera {
      background: linear-gradient(135deg, #4169E1 0%, #6495ED 100%);
      color: white;
    }
    
    .action-btn.save-back {
      background: linear-gradient(135deg, #808080 0%, #696969 100%);
      color: white;
    }
    
    .action-btn:active {
      transform: scale(0.98);
    }
    
    /* ===== ORDER COMPLETE ëª¨ë‹¬ ===== */
    #orderModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 10000;
      overflow: auto;
    }
    
    #orderModal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .order-modal-content {
      background: white;
      border-radius: 16px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    
    .order-modal-header {
      background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
      color: white;
      padding: 20px;
      border-radius: 16px 16px 0 0;
      font-size: 22px;
      font-weight: 700;
      text-align: center;
    }
    
    /* íšŒì‚¬ íƒ­ */
    .company-tabs {
      display: flex;
      background: #f5f5f5;
      border-bottom: 2px solid #ddd;
    }
    
    .company-tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background: #f5f5f5;
      color: #999;
      border: none;
      transition: all 0.3s;
    }
    
    .company-tab:hover {
      background: #e8e8e8;
    }
    
    .company-tab.active {
      background: white;
      color: #333;
      border-bottom: 3px solid #FF8C00;
    }
    
    .company-tab.active.tab-outre {
      border-bottom-color: #FF8C00;
    }
    
    .company-tab.active.tab-sng {
      border-bottom-color: #4169E1;
    }
    
    .order-modal-body {
      flex: 1;
      overflow: auto;
      padding: 20px;
    }
    
    .order-table-container {
      overflow-x: auto;
      margin-bottom: 20px;
    }
    
    .order-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    
    .order-table th {
      background: #f5f5f5;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #ddd;
    }
    
    .order-table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }
    
    .empty-message {
      text-align: center;
      padding: 40px;
      color: #999;
      font-size: 16px;
    }
    
    .order-modal-footer {
      padding: 20px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .modal-btn {
      flex: 1;
      min-width: 120px;
      padding: 15px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.2s;
    }
    
    .modal-btn:active {
      transform: scale(0.98);
    }
    
    .modal-btn.copy {
      background: linear-gradient(135deg, #4169E1 0%, #6495ED 100%);
      color: white;
    }
    
    .modal-btn.clear-list {
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      color: white;
    }
    
    .modal-btn.close {
      background: linear-gradient(135deg, #808080 0%, #696969 100%);
      color: white;
    }
    
    /* ===== ì•Œë¦¼ ===== */
    #alertMessage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 20px 40px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      text-align: center;
      z-index: 20000;
      display: none;
      max-width: 90%;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    
    #alertMessage.show {
      display: block;
      animation: fadeInOut 3s;
    }
    
    @keyframes fadeInOut {
      0%, 100% { opacity: 0; }
      10%, 90% { opacity: 1; }
    }
    
    /* ===== ë°˜ì‘í˜• ===== */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 18px;
      }
      
      .order-complete-header-btn {
        font-size: 12px;
        padding: 6px 12px;
      }
      
      .quantity-controls {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .qty-btn {
        height: 45px;
        font-size: 16px;
      }
      
      .products-table th,
      .products-table td {
        padding: 10px;
        font-size: 14px;
      }
      
      .quantity-input {
        width: 60px;
        height: 40px;
        font-size: 16px;
      }
    }
    
    @media (max-width: 480px) {
      .barcode-container {
        flex-direction: column;
      }
      
      .camera-btn {
        width: 100%;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .order-modal-footer {
        flex-direction: column;
      }
      
      .modal-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ›’ CC3 HAIR ORDER APP</h1>
      <button class="order-complete-header-btn" onclick="app.showOrderComplete()">
        ORDER COMPLETE
      </button>
    </div>
    
    <div class="content">
      <!-- ë°”ì½”ë“œ ì…ë ¥ ì„¹ì…˜ -->
      <div id="inputSection">
        <div class="input-label">
          ğŸ” ë°”ì½”ë“œ ë˜ëŠ” ì œí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”
        </div>
        
        <div class="barcode-container">
          <input type="text" id="barcodeDisplay" maxlength="50" inputmode="text">
          <button class="camera-btn" onclick="app.openCamera()">ğŸ“· ì¹´ë©”ë¼</button>
        </div>
        
        <div class="keypad">
          <button class="key-btn" onclick="app.addDigit('1')">1</button>
          <button class="key-btn" onclick="app.addDigit('2')">2</button>
          <button class="key-btn" onclick="app.addDigit('3')">3</button>
          <button class="key-btn" onclick="app.addDigit('4')">4</button>
          <button class="key-btn" onclick="app.addDigit('5')">5</button>
          <button class="key-btn" onclick="app.addDigit('6')">6</button>
          <button class="key-btn" onclick="app.addDigit('7')">7</button>
          <button class="key-btn" onclick="app.addDigit('8')">8</button>
          <button class="key-btn" onclick="app.addDigit('9')">9</button>
          <button class="key-btn delete" onclick="app.clearBarcode()">âŒ«</button>
          <button class="key-btn" onclick="app.addDigit('0')">0</button>
          <button class="key-btn delete" onclick="app.deleteDigit()">â†</button>
        </div>
      </div>
      
      <!-- ë¡œë”© -->
      <div id="loading">
        <div class="spinner"></div>
        <div class="loading-text">ê²€ìƒ‰ ì¤‘...</div>
      </div>
      
      <!-- ê²°ê³¼ ì„¹ì…˜ -->
      <div id="resultsSection">
        <div class="action-buttons-top">
          <button class="action-btn-top add" onclick="app.addToOrder()">
            <span style="font-size: 24px;">â•</span>
          </button>
          <button class="action-btn-top save-camera" onclick="app.saveAndOpenCamera()">
            <span style="font-size: 20px;">ğŸ’¾ğŸ“·</span>
          </button>
          <button class="action-btn-top save-back" onclick="app.saveAndGoBack()">
            <span style="font-size: 20px;">ğŸ’¾â†©ï¸</span>
          </button>
          <button class="action-btn-top cart" onclick="app.showOrderComplete()">
            <span style="font-size: 24px;">ğŸ›’</span>
          </button>
        </div>
        
        <div class="quantity-controls">
          <button class="qty-btn" onclick="app.adjustQuantity(1)">+1</button>
          <button class="qty-btn" onclick="app.adjustQuantity(3)">+3</button>
          <button class="qty-btn" onclick="app.adjustQuantity(6)">+6</button>
          <button class="qty-btn" onclick="app.adjustQuantity(10)">+10</button>
          <button class="qty-btn" onclick="app.adjustQuantity(12)">+12</button>
          <button class="qty-btn clear" onclick="app.clearQuantity()">CLEAR</button>
        </div>
        
        <div class="table-container">
          <table class="products-table">
            <thead>
              <tr>
                <th>ìˆ˜ëŸ‰</th>
                <th>ITEM NAME</th>
                <th>COLOR</th>
                <th>íšŒì‚¬</th>
              </tr>
            </thead>
            <tbody id="productsTableBody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ì¹´ë©”ë¼ ëª¨ë‹¬ -->
  <div id="cameraModal">
    <div class="camera-header">
      ğŸ“· ë°”ì½”ë“œë¥¼ í™”ë©´ ì¤‘ì•™ì— ë§ì¶”ì„¸ìš”
    </div>
    <div class="camera-viewport">
      <video id="video" autoplay playsinline></video>
      <canvas id="canvas" style="display:none;"></canvas>
    </div>
    <div class="camera-footer">
      <button class="close-camera-btn" onclick="app.closeCamera()">âœ• ë‹«ê¸°</button>
    </div>
  </div>
  
  <!-- ORDER COMPLETE ëª¨ë‹¬ -->
  <div id="orderModal">
    <div class="order-modal-content">
      <div class="order-modal-header">
        ğŸ“¦ ì£¼ë¬¸ ë‚´ì—­
      </div>
      
      <!-- íšŒì‚¬ íƒ­ -->
      <div class="company-tabs">
        <button class="company-tab tab-sng active" onclick="app.switchCompany('SNG')">
          SNG
        </button>
        <button class="company-tab tab-outre" onclick="app.switchCompany('OUTRE')">
          OUTRE
        </button>
      </div>
      
      <div class="order-modal-body" id="orderModalBody">
        <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
      </div>
      <div class="order-modal-footer">
        <button class="modal-btn copy" onclick="app.copyOrderData()">
          ğŸ“‹ ë³µì‚¬í•˜ê¸°
        </button>
        <button class="modal-btn clear-list" onclick="app.clearOrderList()">
          ğŸ—‘ï¸ ë¦¬ìŠ¤íŠ¸ ë¹„ìš°ê¸°
        </button>
        <button class="modal-btn close" onclick="app.closeOrderModal()">
          âœ• ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>
  
  <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
  <div id="alertMessage"></div>
  
  <script>
    // ============================================================================
    // CC3 HAIR ORDER APP - Frontend v4.1
    // Multi-Company Support (OUTRE + SNG) + Product Search
    // ============================================================================
    
    var app = {
      // ìƒíƒœ
      barcode: '',
      products: [],
      selectedRow: -1,
      cameraActive: false,
      processing: false,
      orderData: {},  // { OUTRE: [], SNG: [] }
      detectionBuffer: {},
      currentCompany: null,  // í˜„ì¬ ìŠ¤ìº”ëœ íšŒì‚¬ (OUTRE or SNG)
      viewingCompany: 'SNG',  // ì¥ë°”êµ¬ë‹ˆì—ì„œ ë³´ê³  ìˆëŠ” íšŒì‚¬
      
      // DOM ìš”ì†Œ
      barcodeDisplay: null,
      inputSection: null,
      resultsSection: null,
      loading: null,
      productsTableBody: null,
      cameraModal: null,
      orderModal: null,
      orderModalBody: null,
      alertMessage: null,
      
      // ì´ˆê¸°í™”
      init: function() {
        console.log('=== CC3 HAIR ORDER APP ì‹œì‘ ===');
        
        // DOM ìš”ì†Œ ìºì‹±
        this.barcodeDisplay = document.getElementById('barcodeDisplay');
        this.inputSection = document.getElementById('inputSection');
        this.resultsSection = document.getElementById('resultsSection');
        this.loading = document.getElementById('loading');
        this.productsTableBody = document.getElementById('productsTableBody');
        this.cameraModal = document.getElementById('cameraModal');
        this.orderModal = document.getElementById('orderModal');
        this.orderModalBody = document.getElementById('orderModalBody');
        this.alertMessage = document.getElementById('alertMessage');
        
        // ë°”ì½”ë“œ ì…ë ¥ ì´ë²¤íŠ¸
        this.barcodeDisplay.addEventListener('input', this.onBarcodeInput.bind(this));
        this.barcodeDisplay.addEventListener('paste', this.onBarcodePaste.bind(this));
        this.barcodeDisplay.addEventListener('keydown', this.onBarcodeKeyDown.bind(this));
        
        // ë°”ì½”ë“œ ìŠ¤ìºë„ˆ ì´ë²¤íŠ¸
        this.setupBarcodeScanner();
        
        console.log('ì´ˆê¸°í™” ì™„ë£Œ');
      },
      
      // ë°”ì½”ë“œ ìŠ¤ìºë„ˆ ì„¤ì •
      setupBarcodeScanner: function() {
        var self = this;
        var scanBuffer = '';
        var scanTimeout = null;
        
        document.addEventListener('keydown', function(e) {
          if (self.cameraActive || self.orderModal.classList.contains('active')) {
            return;
          }
          
          if (e.key.length === 1 && /[0-9]/.test(e.key)) {
            scanBuffer += e.key;
            
            clearTimeout(scanTimeout);
            scanTimeout = setTimeout(function() {
              if (scanBuffer.length === 12) {
                console.log('ìŠ¤ìºë„ˆ ì…ë ¥:', scanBuffer);
                self.barcode = scanBuffer;
                self.barcodeDisplay.value = scanBuffer;
                self.searchProduct();
              }
              scanBuffer = '';
            }, 100);
          } else if (e.key === 'Enter' && scanBuffer.length === 12) {
            e.preventDefault();
            console.log('ìŠ¤ìºë„ˆ ì…ë ¥ (Enter):', scanBuffer);
            self.barcode = scanBuffer;
            self.barcodeDisplay.value = scanBuffer;
            scanBuffer = '';
            clearTimeout(scanTimeout);
            self.searchProduct();
          }
        });
      },
      
      // ë°”ì½”ë“œ ì…ë ¥
      onBarcodeInput: function(e) {
        this.barcode = e.target.value.trim();
      },
      
      // ë°”ì½”ë“œ í‚¤ë‹¤ìš´
      onBarcodeKeyDown: function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          this.searchProduct();
        }
      },
      
      // ë°”ì½”ë“œ ë¶™ì—¬ë„£ê¸°
      onBarcodePaste: function(e) {
        e.preventDefault();
        var pastedText = (e.clipboardData || window.clipboardData).getData('text');
        var cleaned = pastedText.trim().substring(0, 50);
        
        this.barcode = cleaned;
        this.barcodeDisplay.value = cleaned;
        
        var self = this;
        setTimeout(function() {
          self.searchProduct();
        }, 100);
      },
      
      // ìˆ«ì ì¶”ê°€
      addDigit: function(digit) {
        if (this.barcode.length < 50) {
          this.barcode += digit;
          this.barcodeDisplay.value = this.barcode;
        }
      },
      
      // í•œ ìë¦¬ ì‚­ì œ
      deleteDigit: function() {
        this.barcode = this.barcode.slice(0, -1);
        this.barcodeDisplay.value = this.barcode;
      },
      
      // ë°”ì½”ë“œ ì´ˆê¸°í™”
      clearBarcode: function() {
        this.barcode = '';
        this.barcodeDisplay.value = '';
        this.barcodeDisplay.focus();
      },
      
      // ì œí’ˆ ê²€ìƒ‰
      searchProduct: function() {
        if (this.processing) return;
        
        if (!this.barcode || this.barcode.trim() === '') {
          this.showAlert('âŒ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        console.log('ì œí’ˆ ê²€ìƒ‰:', this.barcode);
        
        this.processing = true;
        this.showSection('loading');
        
        var self = this;
        google.script.run
          .withSuccessHandler(function(result) {
            self.handleSearchSuccess(result);
          })
          .withFailureHandler(function(error) {
            self.handleSearchError(error);
          })
          .searchProduct(this.barcode);
      },
      
      // ê²€ìƒ‰ ì„±ê³µ
      handleSearchSuccess: function(result) {
        this.processing = false;
        
        if (!result.success) {
          this.showAlert(result.error);
          this.showSection('input');
          this.clearBarcode();
          return;
        }
        
        console.log('ê²€ìƒ‰ ì„±ê³µ:', result.products.length, 'ê°œ (' + result.company + ')');
        
        this.products = result.products || [];
        this.currentCompany = result.company;  // OUTRE ë˜ëŠ” SNG
        
        // í…Œë§ˆ ì ìš©
        this.applyTheme(this.currentCompany);
        
        this.displayProducts();
        this.showSection('results');
        
        // ì²« ë²ˆì§¸ ì œí’ˆ ìë™ ì„ íƒ
        if (this.products.length > 0) {
          var self = this;
          setTimeout(function() {
            self.selectRow(0);
            self.scrollToRow(0);
          }, 100);
        }
      },
      
      // ê²€ìƒ‰ ì‹¤íŒ¨
      handleSearchError: function(error) {
        this.processing = false;
        this.showSection('input');
        this.showAlert('âŒ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
        this.clearBarcode();
      },
      
      // í…Œë§ˆ ì ìš©
      applyTheme: function(company) {
        var theme = company === 'OUTRE' ? 'theme-outre' : 'theme-sng';
        
        // body í…Œë§ˆ
        document.body.className = theme;
        
        // í—¤ë” í…Œë§ˆ
        var header = document.querySelector('.header');
        header.className = 'header ' + theme;
        
        // ë°”ì½”ë“œ ì…ë ¥ í…Œë§ˆ
        this.barcodeDisplay.className = theme;
        
        // ì¹´ë©”ë¼ ë²„íŠ¼ í…Œë§ˆ
        var cameraBtn = document.querySelector('.camera-btn');
        cameraBtn.className = 'camera-btn ' + theme;
        
        // í‚¤íŒ¨ë“œ ë²„íŠ¼ í…Œë§ˆ
        var keyBtns = document.querySelectorAll('.key-btn:not(.delete)');
        for (var i = 0; i < keyBtns.length; i++) {
          keyBtns[i].className = 'key-btn ' + theme;
        }
        
        // ë¡œë”© ìŠ¤í”¼ë„ˆ í…Œë§ˆ
        var spinner = document.querySelector('.spinner');
        spinner.className = 'spinner ' + theme;
        
        var loadingText = document.querySelector('.loading-text');
        loadingText.className = 'loading-text ' + theme;
        
        // ìˆ˜ëŸ‰ ë²„íŠ¼ í…Œë§ˆ
        var qtyBtns = document.querySelectorAll('.qty-btn:not(.clear)');
        for (var i = 0; i < qtyBtns.length; i++) {
          qtyBtns[i].className = 'qty-btn ' + theme;
        }
        
        // í…Œì´ë¸” í…Œë§ˆ
        var productsTable = document.querySelector('.products-table');
        productsTable.className = 'products-table ' + theme;
        
        // ìƒë‹¨ ì•¡ì…˜ ë²„íŠ¼ í…Œë§ˆ (ì¶”ê°€ ë²„íŠ¼ë§Œ)
        var addBtnTop = document.querySelector('.action-btn-top.add');
        if (addBtnTop) {
          addBtnTop.className = 'action-btn-top add ' + theme;
        }
        
        // ì¹´ë©”ë¼ í—¤ë” í…Œë§ˆ
        var cameraHeader = document.querySelector('.camera-header');
        cameraHeader.className = 'camera-header ' + theme;
      },
      
      // ì œí’ˆ í‘œì‹œ
      displayProducts: function() {
        this.productsTableBody.innerHTML = '';
        
        var theme = this.currentCompany === 'OUTRE' ? 'theme-outre' : 'theme-sng';
        
        for (var i = 0; i < this.products.length; i++) {
          var product = this.products[i];
          var row = this.productsTableBody.insertRow();
          row.dataset.index = i;
          
          var self = this;
          row.onclick = (function(index) {
            return function() {
              self.selectRow(index);
            };
          })(i);
          
          // ìˆ˜ëŸ‰ (ì²« ë²ˆì§¸ ì»¬ëŸ¼)
          var qtyCell = row.insertCell(0);
          var qtyInput = document.createElement('input');
          qtyInput.type = 'number';
          qtyInput.className = 'quantity-input ' + theme;
          qtyInput.value = product.quantity || 0;
          qtyInput.min = 0;
          qtyInput.inputMode = 'numeric';
          
          qtyInput.onfocus = function() {
            this.blur();
          };
          
          qtyInput.onclick = (function(index, input) {
            return function(e) {
              e.stopPropagation();
              input.blur();
              self.selectRow(index);
            };
          })(i, qtyInput);
          
          qtyInput.oninput = (function(index, input) {
            return function() {
              var val = parseInt(input.value) || 0;
              self.products[index].quantity = Math.max(0, val);
              input.value = self.products[index].quantity;
            };
          })(i, qtyInput);
          
          qtyCell.appendChild(qtyInput);
          
          // ITEM NAME (ë‘ ë²ˆì§¸ ì»¬ëŸ¼)
          var nameCell = row.insertCell(1);
          nameCell.textContent = product.itemName || '';
          nameCell.style.fontWeight = '600';
          
          // COLOR (ì„¸ ë²ˆì§¸ ì»¬ëŸ¼)
          var colorCell = row.insertCell(2);
          colorCell.textContent = product.color || '';
          
          // íšŒì‚¬ ë±ƒì§€ (ë„¤ ë²ˆì§¸ ì»¬ëŸ¼)
          var companyCell = row.insertCell(3);
          var badge = document.createElement('span');
          badge.className = 'company-badge ' + (product.company === 'OUTRE' ? 'outre' : 'sng');
          badge.textContent = product.company;
          companyCell.appendChild(badge);
        }
      },
      
      // ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™
      gotoOrderPage: function(company) {
        console.log('ì£¼ë¬¸ í˜ì´ì§€ ì´ë™:', company);
        this.viewingCompany = company;
        this.showOrderComplete();
      },
      
      // í–‰ ì„ íƒ
      selectRow: function(index) {
        if (index < 0 || index >= this.products.length) return;
        
        var rows = this.productsTableBody.rows;
        for (var i = 0; i < rows.length; i++) {
          rows[i].classList.remove('selected');
        }
        
        rows[index].classList.add('selected');
        this.selectedRow = index;
      },
      
      // íŠ¹ì • í–‰ìœ¼ë¡œ ìŠ¤í¬ë¡¤
      scrollToRow: function(index) {
        if (index < 0 || index >= this.products.length) return;
        
        var rows = this.productsTableBody.rows;
        if (!rows[index]) return;
        
        var targetRow = rows[index];
        var tableContainer = document.querySelector('.table-container');
        
        if (!tableContainer) return;
        
        // í…Œì´ë¸” ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ í–‰ì˜ ìƒëŒ€ì  ìœ„ì¹˜ ê³„ì‚°
        var containerRect = tableContainer.getBoundingClientRect();
        var rowRect = targetRow.getBoundingClientRect();
        
        // í–‰ì´ ì»¨í…Œì´ë„ˆì˜ ì¤‘ì•™ì— ì˜¤ë„ë¡ ìŠ¤í¬ë¡¤
        var scrollOffset = (rowRect.top - containerRect.top) + tableContainer.scrollTop - (containerRect.height / 2) + (rowRect.height / 2);
        
        // ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤
        tableContainer.scrollTo({
          top: scrollOffset,
          behavior: 'smooth'
        });
        
        console.log('í–‰ìœ¼ë¡œ ìŠ¤í¬ë¡¤: index=' + index);
      },
      
      // ìˆ˜ëŸ‰ ì¡°ì ˆ
      adjustQuantity: function(amount) {
        if (this.selectedRow === -1) return;
        
        this.products[this.selectedRow].quantity = Math.max(0, 
          (this.products[this.selectedRow].quantity || 0) + amount);
        
        this.displayProducts();
        this.selectRow(this.selectedRow);
      },
      
      // ìˆ˜ëŸ‰ ì´ˆê¸°í™”
      clearQuantity: function() {
        if (this.selectedRow === -1) return;
        
        this.products[this.selectedRow].quantity = 0;
        this.displayProducts();
        this.selectRow(this.selectedRow);
      },
      
      // ì£¼ë¬¸ì— ì¶”ê°€
      addToOrder: function() {
        var hasQty = false;
        for (var i = 0; i < this.products.length; i++) {
          if ((this.products[i].quantity || 0) > 0) {
            hasQty = true;
            break;
          }
        }
        
        if (!hasQty) {
          this.showAlert('âš ï¸ ìˆ˜ëŸ‰ì´ ì…ë ¥ëœ ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        if (this.processing) return;
        
        console.log('ì£¼ë¬¸ ì¶”ê°€ ì‹œì‘ (' + this.currentCompany + ')');
        
        this.processing = true;
        this.showSection('loading');
        
        var self = this;
        google.script.run
          .withSuccessHandler(function(result) {
            self.handleAddSuccess(result);
          })
          .withFailureHandler(function(error) {
            self.handleAddError(error);
          })
          .addToOrder(this.products, this.currentCompany);
      },
      
      // ì €ì¥ í›„ ì¹´ë©”ë¼ ì—´ê¸°
      saveAndOpenCamera: function() {
        var hasQty = false;
        for (var i = 0; i < this.products.length; i++) {
          if ((this.products[i].quantity || 0) > 0) {
            hasQty = true;
            break;
          }
        }
        
        if (!hasQty) {
          // ìˆ˜ëŸ‰ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì¹´ë©”ë¼ë§Œ ì—´ê¸°
          this.reset();
          this.openCamera();
          return;
        }
        
        if (this.processing) return;
        
        console.log('ì €ì¥ í›„ ì¹´ë©”ë¼ ì—´ê¸° (' + this.currentCompany + ')');
        
        this.processing = true;
        this.showSection('loading');
        
        var self = this;
        google.script.run
          .withSuccessHandler(function(result) {
            self.handleSaveAndCameraSuccess(result);
          })
          .withFailureHandler(function(error) {
            self.handleAddError(error);
          })
          .addToOrder(this.products, this.currentCompany);
      },
      
      // ì €ì¥ í›„ ëŒì•„ê°€ê¸°
      saveAndGoBack: function() {
        var hasQty = false;
        for (var i = 0; i < this.products.length; i++) {
          if ((this.products[i].quantity || 0) > 0) {
            hasQty = true;
            break;
          }
        }
        
        if (!hasQty) {
          // ìˆ˜ëŸ‰ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ëŒì•„ê°€ê¸°
          this.reset();
          return;
        }
        
        if (this.processing) return;
        
        console.log('ì €ì¥ í›„ ëŒì•„ê°€ê¸° (' + this.currentCompany + ')');
        
        this.processing = true;
        this.showSection('loading');
        
        var self = this;
        google.script.run
          .withSuccessHandler(function(result) {
            self.handleSaveAndBackSuccess(result);
          })
          .withFailureHandler(function(error) {
            self.handleAddError(error);
          })
          .addToOrder(this.products, this.currentCompany);
      },
      
      // ì¶”ê°€ ì„±ê³µ
      handleAddSuccess: function(result) {
        this.processing = false;
        
        if (result.success) {
          this.showAlert(result.message, 2000);
          this.reset();
        } else {
          this.showAlert(result.error);
          this.showSection('results');
        }
      },
      
      // ì €ì¥ í›„ ì¹´ë©”ë¼ ì„±ê³µ
      handleSaveAndCameraSuccess: function(result) {
        this.processing = false;
        
        if (result.success) {
          // ì•Œë¦¼ ì—†ì´ ë°”ë¡œ ë¦¬ì…‹í•˜ê³  ì¹´ë©”ë¼ ì—´ê¸°
          this.reset();
          var self = this;
          setTimeout(function() {
            self.openCamera();
          }, 100);
        } else {
          this.showAlert(result.error);
          this.showSection('results');
        }
      },
      
      // ì €ì¥ í›„ ëŒì•„ê°€ê¸° ì„±ê³µ
      handleSaveAndBackSuccess: function(result) {
        this.processing = false;
        
        if (result.success) {
          // ì•Œë¦¼ ì—†ì´ ë°”ë¡œ ë¦¬ì…‹
          this.reset();
        } else {
          this.showAlert(result.error);
          this.showSection('results');
        }
      },
      
      // ì¶”ê°€ ì‹¤íŒ¨
      handleAddError: function(error) {
        this.processing = false;
        this.showSection('results');
        this.showAlert('âŒ ì£¼ë¬¸ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        console.error('ì¶”ê°€ ì˜¤ë¥˜:', error);
      },
      
      // ì·¨ì†Œ
      cancel: function() {
        this.reset();
      },
      
      // ë¦¬ì…‹
      reset: function() {
        this.barcode = '';
        this.products = [];
        this.selectedRow = -1;
        this.processing = false;
        this.currentCompany = null;
        this.barcodeDisplay.value = '';
        
        // ì´ˆê¸° í…Œë§ˆë¡œ ë³µê·€
        this.applyTheme(null);
        
        this.showSection('input');
      },
      
      // ì„¹ì…˜ í‘œì‹œ
      showSection: function(section) {
        var header = document.querySelector('.header');
        
        this.inputSection.style.display = section === 'input' ? 'block' : 'none';
        this.resultsSection.style.display = section === 'results' ? 'block' : 'none';
        this.loading.style.display = section === 'loading' ? 'block' : 'none';
        
        // ìˆ˜ëŸ‰ ì…ë ¥ í™”ë©´ì—ì„œëŠ” í—¤ë” ìˆ¨ê¹€
        if (section === 'results') {
          header.style.display = 'none';
        } else {
          header.style.display = 'block';
        }
      },
      
      // ì•Œë¦¼ í‘œì‹œ
      showAlert: function(message, duration) {
        var self = this;
        this.alertMessage.textContent = message;
        this.alertMessage.className = 'show';
        
        setTimeout(function() {
          self.alertMessage.className = '';
        }, duration || 3000);
      },
      
      // ===== ì¹´ë©”ë¼ ê¸°ëŠ¥ (ZXing - ê°•ë ¥í•œ ëª¨ë°”ì¼ ì§€ì›) =====
      
      codeReader: null,
      videoElement: null,
      canvasElement: null,
      
      openCamera: function() {
        console.log('ì¹´ë©”ë¼ ì—´ê¸°');
        this.cameraModal.classList.add('active');
        this.startCamera();
      },
      
      startCamera: function() {
        var self = this;
        
        // ZXing ì´ˆê¸°í™”
        this.codeReader = new ZXing.BrowserMultiFormatReader();
        this.videoElement = document.getElementById('video');
        this.canvasElement = document.getElementById('canvas');
        
        console.log('ZXing ì¹´ë©”ë¼ ì‹œì‘...');
        
        // í›„ë©´ ì¹´ë©”ë¼ ì„ íƒ
        this.codeReader.listVideoInputDevices()
          .then(function(videoInputDevices) {
            console.log('ê°ì§€ëœ ì¹´ë©”ë¼:', videoInputDevices.length + 'ê°œ');
            
            // í›„ë©´ ì¹´ë©”ë¼ ì°¾ê¸°
            var selectedDeviceId = videoInputDevices[0].deviceId;
            
            for (var i = 0; i < videoInputDevices.length; i++) {
              var device = videoInputDevices[i];
              var label = device.label.toLowerCase();
              
              // í›„ë©´ ì¹´ë©”ë¼ í‚¤ì›Œë“œ
              if (label.indexOf('back') > -1 || 
                  label.indexOf('rear') > -1 || 
                  label.indexOf('í™˜ê²½') > -1 ||
                  label.indexOf('í›„ë©´') > -1) {
                selectedDeviceId = device.deviceId;
                console.log('í›„ë©´ ì¹´ë©”ë¼ ì„ íƒ:', device.label);
                break;
              }
            }
            
            // ì—°ì† ìŠ¤ìº” ì‹œì‘
            self.codeReader.decodeFromVideoDevice(selectedDeviceId, self.videoElement, function(result, err) {
              if (result) {
                var code = result.text;
                console.log('ë°”ì½”ë“œ ê°ì§€:', code);
                
                // 12ìë¦¬ ìˆ«ì ê²€ì¦
                if (code && code.length === 12 && /^\d{12}$/.test(code)) {
                  console.log('âœ… ìœ íš¨í•œ ë°”ì½”ë“œ:', code);
                  
                  // ì§„ë™
                  if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                  }
                  
                  // ì¹´ë©”ë¼ ì¤‘ì§€ ë° ê²€ìƒ‰
                  self.closeCamera();
                  self.barcode = code;
                  self.barcodeDisplay.value = code;
                  
                  setTimeout(function() {
                    self.searchProduct();
                  }, 300);
                } else {
                  console.log('âŒ ë¬´íš¨í•œ ë°”ì½”ë“œ (12ìë¦¬ ì•„ë‹˜):', code);
                }
              }
              
              if (err && err.name !== 'NotFoundException') {
                console.log('ìŠ¤ìº” ì˜¤ë¥˜:', err);
              }
            });
            
            self.cameraActive = true;
            console.log('ì¹´ë©”ë¼ ì‹œì‘ ì„±ê³µ');
          })
          .catch(function(err) {
            console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜:', err);
            self.showAlert('âŒ ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì¹´ë©”ë¼ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            self.closeCamera();
          });
      },
      
      closeCamera: function() {
        console.log('ì¹´ë©”ë¼ ë‹«ê¸°');
        
        try {
          // ZXing ì¹´ë©”ë¼ ì¤‘ì§€
          if (this.codeReader) {
            this.codeReader.reset();
            this.codeReader = null;
          }
          
          // ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì¤‘ì§€
          if (this.videoElement && this.videoElement.srcObject) {
            var tracks = this.videoElement.srcObject.getTracks();
            for (var i = 0; i < tracks.length; i++) {
              tracks[i].stop();
            }
            this.videoElement.srcObject = null;
          }
        } catch (e) {
          console.log('ì¹´ë©”ë¼ ì¤‘ì§€ ì˜¤ë¥˜:', e);
        }
        
        this.cameraModal.classList.remove('active');
        this.cameraActive = false;
      },
      
      // ===== ORDER COMPLETE ê¸°ëŠ¥ =====
      
      showOrderComplete: function() {
        console.log('ORDER COMPLETE ì—´ê¸°');
        this.loadOrderData(this.viewingCompany);
        this.orderModal.classList.add('active');
      },
      
      // íšŒì‚¬ ì „í™˜
      switchCompany: function(company) {
        this.viewingCompany = company;
        
        // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
        var tabs = document.querySelectorAll('.company-tab');
        for (var i = 0; i < tabs.length; i++) {
          tabs[i].classList.remove('active');
        }
        
        var activeTab = company === 'SNG' ? 
          document.querySelector('.company-tab.tab-sng') : 
          document.querySelector('.company-tab.tab-outre');
        activeTab.classList.add('active');
        
        // í•´ë‹¹ íšŒì‚¬ ë°ì´í„° ë¡œë“œ
        this.loadOrderData(company);
      },
      
      // ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ
      loadOrderData: function(company) {
        var self = this;
        google.script.run
          .withSuccessHandler(function(result) {
            self.displayOrderData(result, company);
          })
          .withFailureHandler(function(error) {
            self.showAlert('âŒ ì£¼ë¬¸ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨');
            console.error('ì¡°íšŒ ì˜¤ë¥˜:', error);
          })
          .getOrderData(company);
      },
      
      displayOrderData: function(result, company) {
        if (!result.success) {
          this.showAlert(result.error);
          return;
        }
        
        this.orderData[company] = result.data || [];
        
        if (this.orderData[company].length === 0) {
          this.orderModalBody.innerHTML = '<div class="empty-message">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        } else {
          var html = '<div class="order-table-container"><table class="order-table">';
          
          for (var i = 0; i < this.orderData[company].length; i++) {
            var row = this.orderData[company][i];
            html += '<tr>';
            
            for (var j = 0; j < row.length; j++) {
              var tag = i === 0 ? 'th' : 'td';
              html += '<' + tag + '>' + (row[j] || '') + '</' + tag + '>';
            }
            
            html += '</tr>';
          }
          
          html += '</table></div>';
          this.orderModalBody.innerHTML = html;
        }
      },
      
      copyOrderData: function() {
        var data = this.orderData[this.viewingCompany];
        
        if (!data || data.length === 0) {
          this.showAlert('ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        var text = '';
        for (var i = 0; i < data.length; i++) {
          text += data[i].join('\t') + '\n';
        }
        
        var self = this;
        
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(text).then(function() {
            self.showAlert('âœ… ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 2000);
          }).catch(function(err) {
            console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
            self.fallbackCopy(text);
          });
        } else {
          this.fallbackCopy(text);
        }
      },
      
      fallbackCopy: function(text) {
        var textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        
        try {
          document.execCommand('copy');
          this.showAlert('âœ… ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 2000);
        } catch (err) {
          console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
          this.showAlert('âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        
        document.body.removeChild(textarea);
      },
      
      clearOrderList: function() {
        var companyName = this.viewingCompany === 'SNG' ? 'SNG' : 'OUTRE';
        
        if (!confirm(companyName + ' ì£¼ë¬¸ ë‚´ì—­ì„ ë°±ì—…í•˜ê³  ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?\n\në°±ì—…ì€ ë‚ ì§œ_ì‹œê°„ ì´ë¦„ì˜ ìˆ¨ê¹€ íƒ­ì— ì €ì¥ë©ë‹ˆë‹¤.')) {
          return;
        }
        
        console.log('ë¦¬ìŠ¤íŠ¸ ë¹„ìš°ê¸°: ' + this.viewingCompany);
        
        var self = this;
        google.script.run
          .withSuccessHandler(function(result) {
            if (result.success) {
              self.showAlert(result.message);
              self.loadOrderData(self.viewingCompany);
            } else {
              self.showAlert(result.error);
            }
          })
          .withFailureHandler(function(error) {
            self.showAlert('âŒ ë¦¬ìŠ¤íŠ¸ ë¹„ìš°ê¸° ì‹¤íŒ¨');
            console.error('ë¹„ìš°ê¸° ì˜¤ë¥˜:', error);
          })
          .clearOrderList(this.viewingCompany);
      },
      
      closeOrderModal: function() {
        this.orderModal.classList.remove('active');
      }
    };
    
    // ì•± ì‹œì‘
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        app.init();
      });
    } else {
      app.init();
    }
  </script>
</body>
</html>